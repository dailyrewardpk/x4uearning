<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X4U Earning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        :root {
            --primary-color: #483D8B; /* Purple */
            --dark-bg: #121212; /* Black background */
            --text-color: #ffffff;
            --text-muted: #b0b0b0; /* Lighter grey for muted text on dark */
            --gradient-start: #8e44ad; /* Purple */
            --gradient-end: #c83765; /* Pink/Red */
            --button-blue-gradient: linear-gradient(to right, #00c6ff, #0072ff); /* Blue gradient */
            --gold-color: #FFD700; /* Gold */
            --card-bg: #1e1e1e; /* Slightly lighter black for cards */
            --border-color: #333333; /* Subtle border */
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .mobile-container {
            width: 100%;
            max-width: 450px;
            background-color: var(--dark-bg);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border-color); /* Subtle border around container */
        }
        /* --- AUTHENTICATION PAGES --- */
        .auth-container {
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-size: cover;
            background-position: center;
            text-align: center;
            /* Optional: Add a subtle background pattern or texture */
            /* background-image: url('image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23121212"/><path d="M0 0L100 100M100 0L0 100" stroke="%231a1a1a" stroke-width="0.5"/></svg>'); */
        }
        .auth-logo {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(142, 68, 173, 0.5); /* Purple glow */
        }
        .auth-logo span {
            color: var(--gold-color);
        }
        .auth-form {
            width: 100%;
            max-width: 350px;
            background-color: rgba(30, 30, 30, 0.7); /* Semi-transparent card bg */
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }
        .auth-form input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 1em;
        }
        .auth-form input::placeholder {
            color: var(--text-muted);
        }
        .auth-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: var(--button-blue-gradient);
            color: white;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(0, 114, 255, 0.3); /* Blue shadow */
        }
        .auth-btn:hover {
             box-shadow: 0 6px 15px rgba(0, 114, 255, 0.5);
        }
        .auth-toggle-link {
            margin-top: 20px;
            color: var(--text-muted);
            cursor: pointer;
            text-decoration: underline;
        }
        #login-page { display: none; }
        /* --- MAIN APP CONTAINER --- */
        #main-app { display: none; padding-bottom: 80px; }
        /* --- Common Header & Page Styles --- */
        .header {
            background: linear-gradient(90deg, var(--gradient-start), var(--primary-color)); /* Purple gradient */
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        .header-title {
            font-size: 1.5em;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        .header-title span {
            color: var(--gold-color);
        }
        .power-btn, .back-btn {
            background: transparent;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .power-btn {
            color: #ff4757;
            font-size: 1.4em;
        }
        .power-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        .back-btn {
            color: #e67e22;
            font-size: 1.4em;
        }
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .page {
            padding: 20px;
        }
        .page-title {
            font-size: 1.8em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            color: var(--gold-color); /* Gold title */
        }
        #dashboard-page, #payment-page, #withdraw-fund-page, #packages-page, #deposit-payment-page, #deposit-details-page, #profile-page, #earning-history-page, #withdraw-history-page, #referrals-page, #active-deposits-page, #task-page { display: none; }
        #dashboard-page { display: block; }
        /* --- Dashboard Page Styles --- */
        .info-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        .card {
            background: linear-gradient(135deg, var(--card-bg), #2a2a2a); /* Dark card gradient */
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .card .card-title {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        .card .card-value {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--gold-color); /* Gold value */
        }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            text-align: center;
        }
        .icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }
        .icon-item:hover {
            transform: translateY(-5px);
            opacity: 0.9;
        }
        .icon-item .icon-bg {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .icon-item .icon-bg i {
            font-size: 2em;
            color: white;
        }
        .icon-item p {
            font-size: 0.9em;
            font-weight: 500;
        }
/* --- REFERRALS STYLES (SHARED) --- */
.invitation-container {
    background: var(--card-bg);
    padding: 15px;
    border-radius: 15px;
    border: 1px solid var(--border-color);
    margin-bottom: 30px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}
.invitation-container h3 {
    font-size: 1.3em; /* Thora chota title */
    margin-bottom: 15px;
    color: var(--gold-color);
    text-align: center; /* Title ko center mein karein */
}
.link-box {
    display: flex;
    align-items: center; /* Input aur button ko aamne samne align karein */
}
.link-box input {
    flex-grow: 1;
    padding: 10px; /* Padding kam ki gayi hai */
    border: 1px solid var(--border-color);
    background: var(--dark-bg); /* Background thora gehra kiya hai */
    color: white;
    border-top-left-radius: 8px;
    border-bottom-left-radius: 8px;
    font-size: 0.8em; /* Font size chota kiya hai */
    /* Yeh line lambe link ko aage '...' ke sath dikhayegi */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.link-box button {
    padding: 10px 15px; /* Padding kam ki gayi hai */
    border: none;
    background: var(--button-blue-gradient);
    color: white;
    border-top-right-radius: 8px;
    border-bottom-right-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    flex-shrink: 0; /* Button ko shrink hone se rokein */
}
        /* --- Referrals Page Specific --- */
        .referrals-list-title {
            padding: 15px;
            background: linear-gradient(90deg, var(--gradient-start), var(--primary-color));
            border-radius: 10px;
            font-size: 1.2em;
            text-align: center;
            margin-bottom: 15px;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .referrals-list-container {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }
        .referrals-list-header {
            display: grid;
            grid-template-columns: 0.5fr 1.5fr 1fr 1fr 1fr;
            padding-bottom: 10px;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            text-align: center;
            color: var(--gold-color);
        }
        .referral-row {
            display: grid;
            grid-template-columns: 0.5fr 1.5fr 1fr 1fr 1fr;
            text-align: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .referral-row:last-child {
            border-bottom: none;
        }
        .no-referrals {
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
        }
        /* --- ACTIVE DEPOSITS PAGE (NEW) --- */
        .deposits-table-container {
            border-radius: 10px;
            padding: 15px;
            margin-top: 25px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        .deposits-table-header {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1fr;
            color: white;
            font-weight: 500;
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(90deg, #622e8a, #d9526c, #f39d5e);
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .deposits-table-body {
            padding-top: 15px;
            min-height: 400px;
            position: relative;
        }
        .deposits-table-body .history-row {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1fr;
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        .no-deposits-message {
            color: var(--text-muted);
            position: relative;
            z-index: 2;
            padding-top: 20px;
            text-align: center;
        }
        .status-approved {
            color: #2ecc71;
            font-weight: bold;
        }
        .status-rejected {
            color: #e74c3c;
            font-weight: bold;
        }
        .status-pending {
            color: #f1c40f;
            font-weight: bold;
        }
        /* Other page styles */
        .payment-methods-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
       .payment-btn {
    background: var(--button-blue-gradient); /* Sirf yeh line tabdeel ki gayi hai */
    border: none;
    color: var(--text-color);
    padding: 18px;
    border-radius: 10px;
    font-size: 1.1em;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    border: 1px solid var(--border-color);
}
        .payment-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .withdraw-form-container {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .payment-logo {
            max-width: 180px;
            height: auto;
            margin-bottom: 20px;
            background: #333;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .withdraw-form-container input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--dark-bg);
            color: var(--text-color);
            font-size: 1em;
        }
        .withdraw-now-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background: var(--button-blue-gradient);
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 114, 255, 0.3);
        }
        .plan-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        .plan-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--gold-color);
        }
        .plan-price {
            background-color: var(--gold-color);
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }
        .buy-plan-btn {
            background: var(--button-blue-gradient);
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 114, 255, 0.3);
        }
        .plan-details-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            text-align: center;
            gap: 10px;
        }
        .detail-item .detail-value {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--gold-color);
        }
        .detail-item .detail-label {
            font-size: 0.8em;
            color: var(--text-muted);
        }
        .deposit-details-page-content {
            text-align: center;
        }
        .deposit-method-logo {
            max-width: 150px;
            background: #333;
            padding: 10px;
            border-radius: 8px;
            margin: 0 auto 20px auto;
            display: block;
            border: 1px solid var(--border-color);
        }
        .info-box {
            background: linear-gradient(to right, #f39c12, #e74c3c);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        .details-box, .proof-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-row span:first-child {
            font-weight: 500;
            color: var(--text-muted);
        }
        .detail-row span:last-child {
            font-weight: 600;
        }
        .proof-box h3 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            color: var(--gold-color);
        }
        .proof-box input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--dark-bg);
            color: var(--text-color);
            font-size: 1em;
        }
        .upload-proof-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background: var(--button-blue-gradient);
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 114, 255, 0.3);
        }
        /* --- PROFILE PAGE STYLES --- */
        .profile-form-container {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }
        .profile-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }
        .profile-form-row:last-of-type {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
        .profile-form-row label {
            flex-basis: 30%;
            font-weight: 500;
            color: var(--gold-color);
        }
        .profile-form-row input {
            flex-basis: 70%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--dark-bg);
            color: var(--text-color);
            font-size: 1em;
        }
        /* --- HISTORY PAGES STYLES (COMMON) --- */
        .history-container {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            min-height: 150px;
            border: 1px solid var(--border-color);
        }
        .history-header {
            display: grid;
            padding-bottom: 10px;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            text-align: center;
            color: var(--gold-color);
        }
        .history-header span:first-child {
            text-align: left;
            padding-left: 5px;
        }
        .no-history {
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
        }
        #earning-history-page .history-header {
            grid-template-columns: 0.5fr 1.5fr 1.5fr 1.5fr;
        }
        #withdraw-history-page .history-header {
            grid-template-columns: 0.5fr 1fr 1fr 1fr 1fr;
        }
        #withdraw-history-page .history-row {
            display: grid;
            grid-template-columns: 0.5fr 1fr 1fr 1fr 1fr;
            padding: 10px 0;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 450px;
            background: linear-gradient(90deg, var(--gradient-start), var(--primary-color));
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            border-top: 1px solid var(--border-color);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-color);
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s;
        }
        .nav-item:hover {
            transform: scale(1.1);
        }
        .nav-item i {
            font-size: 1.5em;
            margin-bottom: 5px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
        }
        .nav-item span {
            font-size: 0.8em;
        }
        /* ===== CUSTOM ALERT BOX KI STYLING ===== */
        #custom-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #custom-alert-box {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.6);
            transform: scale(0.9);
            animation: popIn 0.3s forwards;
            border: 1px solid var(--border-color);
        }
        @keyframes popIn {
            to { transform: scale(1); }
        }
        #custom-alert-message {
            font-size: 1.1em;
            margin-bottom: 25px;
            color: var(--text-color);
        }
        #custom-alert-ok-btn {
            padding: 12px 40px;
            border: none;
            border-radius: 25px;
            background: var(--button-blue-gradient);
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 114, 255, 0.3);
        }
        /* ===== CUSTOM CONFIRM BOX KI STYLING ===== */
        #custom-confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }
        #custom-confirm-box {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.6);
            transform: scale(0.9);
            animation: popIn 0.3s forwards;
            border: 1px solid var(--border-color);
        }
        #custom-confirm-message {
            font-size: 1.1em;
            margin-bottom: 25px;
            color: var(--text-color);
        }
        #custom-confirm-buttons {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }
        #custom-confirm-yes-btn, #custom-confirm-no-btn {
            padding: 12px 0;
            flex-grow: 1;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        #custom-confirm-yes-btn {
            background: #e74c3c;
            color: white;
        }
        #custom-confirm-no-btn {
            background: #bdc3c7;
            color: #2c3e50;
        }
        /* Task Page Specific */
        .video-container {
             border: 1px solid var(--border-color) !important;
             box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
        }
        /* Updated Icon Colors - Enhanced and More Vibrant */
        .icon-item:nth-child(1) .icon-bg { background: linear-gradient(135deg, #FF6B6B, #FF8E8E); } /* Buy Plan - Red/Pink */
        .icon-item:nth-child(2) .icon-bg { background: linear-gradient(135deg, #4CC9F0, #4361EE); } /* Withdraw - Blue */
        .icon-item:nth-child(3) .icon-bg { background: linear-gradient(135deg, #70E000, #38B000); } /* Referrals - Green */
        .icon-item:nth-child(4) .icon-bg { background: linear-gradient(135deg, #FF9E00, #FFAA47); } /* Deposits - Orange */
        .icon-item:nth-child(5) .icon-bg { background: linear-gradient(135deg, #9D4EDD, #7B2CBF); } /* History - Purple */
        .icon-item:nth-child(6) .icon-bg { background: linear-gradient(135deg, #F72585, #B5179E); } /* Profile - Pink */
        .icon-item:nth-child(7) .icon-bg { background: linear-gradient(135deg, #4CC9F0, #4895EF); } /* Task - Light Blue */
        .icon-item:nth-child(8) .icon-bg { background: linear-gradient(135deg, #FF6B6B, #FF9E00); } /* Setting - Orange/Red */
        .icon-item:nth-child(9) .icon-bg { background: linear-gradient(135deg, #FF0000, #B22222); } /* Logout - Red */
        .icon-item:nth-child(10) .icon-bg { background: linear-gradient(135deg, #25D366, #128C7E); } /* WhatsApp - Green */
        .icon-item:nth-child(11) .icon-bg { background: linear-gradient(135deg, #4285F4, #34A853, #FBBC05, #EA4335); } /* Admin Contact - Multi-color */
        
        /* Withdrawal Note Card */
        .withdraw-note-card {
            background: linear-gradient(135deg, #1e1e1e, #2a2a2a);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .withdraw-note-card h3 {
            color: var(--gold-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .withdraw-note-card p {
            margin: 5px 0;
            font-size: 0.9em;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- AUTHENTICATION PAGES -->
        <div id="auth-pages">
            <!-- Signup and Login Forms -->
            <div id="signup-page" class="auth-container">
                <div class="auth-form">
                    <h1 class="auth-logo">X4U <span>Earning</span></h1>
                    <form onsubmit="handleAuth(event, 'signup')">
                        <input type="text" id="signup-username" placeholder="Username" required>
                        <input type="tel" id="signup-phone" placeholder="Phone No" required>
                        <input type="email" id="signup-email" placeholder="Email Address" required>
                        <input type="password" id="signup-password" placeholder="Password" required>
                        <button type="submit" class="auth-btn">Signup</button>
                    </form>
                    <p class="auth-toggle-link" onclick="toggleAuthPages()">Already Account? Login</p>
                </div>
            </div>
            <div id="login-page" class="auth-container">
                <div class="auth-form">
                    <h1 class="auth-logo">X4U <span>Earning</span></h1>
                    <form onsubmit="handleAuth(event, 'login')">
                        <input type="email" id="login-email" placeholder="Email Address" required>
                        <input type="password" id="login-password" placeholder="Password" required>
                        <button type="submit" class="auth-btn">Login</button>
                    </form>
                    <p class="auth-toggle-link" onclick="toggleAuthPages()">Don't Have Account? Signup</p>
                </div>
            </div>
        </div>
        <!-- MAIN APPLICATION -->
        <div id="main-app">
            <div id="dashboard-page">
                 <header class="header"><h1 class="header-title">X4U <span>Earning</span></h1><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
                 <main class="page">
                    <section class="info-cards">
                        <div class="card"><p class="card-title">Username</p><p class="card-value" id="dashboard-username">Loading...</p></div>
                        <div class="card"><p class="card-title">Account Balance</p><p class="card-value" id="dashboard-balance">PKR 0.00</p></div>
                        <div class="card"><p class="card-title">Total Deposits</p><p class="card-value" id="dashboard-total-deposits">PKR 0</p></div>
                        <div class="card"><p class="card-title">Total Profit</p><p class="card-value" id="dashboard-total-profit">PKR 0</p></div>
                    </section>
                    <section class="icon-grid">
                        <div class="icon-item" onclick="showPackagesPage()"><div class="icon-bg"><i class="fa-solid fa-cart-shopping"></i></div><p>Buy Plan</p></div>
                        <div class="icon-item" onclick="showPaymentPage()"><div class="icon-bg"><i class="fa-solid fa-money-bill-transfer"></i></div><p>Withdraw</p></div>
                        <div class="icon-item" onclick="showReferralsPage()"><div class="icon-bg"><i class="fa-solid fa-users"></i></div><p>Referrals</p></div>
                        <div class="icon-item" onclick="showActiveDepositsPage()"><div class="icon-bg"><i class="fa-solid fa-wallet"></i></div><p>Deposits</p></div>
                        <div class="icon-item" onclick="showWithdrawHistoryPage()"><div class="icon-bg"><i class="fa-solid fa-history"></i></div><p>History</p></div>
                        <div class="icon-item" onclick="showProfilePage()"><div class="icon-bg"><i class="fa-solid fa-user-pen"></i></div><p>Profile</p></div>
                        <div class="icon-item" onclick="showTaskPage()"><div class="icon-bg"><i class="fa-solid fa-list-check"></i></div><p>Task</p></div>
                        <div class="icon-item" onclick="showProfilePage()"><div class="icon-bg"><i class="fa-solid fa-gears"></i></div><p>Setting</p></div>
                        <div class="icon-item" onclick="handleLogout()"><div class="icon-bg"><i class="fa-solid fa-right-from-bracket"></i></div><p>Logout</p></div>
                        <div class="icon-item" onclick="openGroupChat()"><div class="icon-bg"><i class="fa-brands fa-whatsapp"></i></div><p>WhatsApp</p></div>
                        <div class="icon-item" onclick="contactAdmin()"><div class="icon-bg"><i class="fa-solid fa-envelope"></i></div><p>Admin Contact</p></div>
                    </section>
                    <section class="info-cards" style="margin-top: 30px; margin-bottom: 20px;">
                        <div class="card"><p class="card-title">Pending Deposits</p><p class="card-value" id="dashboard-pending-deposits">PKR 0</p></div>
                        <div class="card">
                            <p class="card-title">Total Referrals Bonus</p>
                            <p class="card-value" id="dashboard-total-commission">PKR 0</p>
                        </div>
                        <div class="card"><p class="card-title">Pending Withdraws</p><p class="card-value" id="dashboard-pending-withdraws">PKR 0</p></div>
                        <div class="card"><p class="card-title">Total Withdraws</p><p class="card-value" id="dashboard-total-withdraws">PKR 0</p></div>
                    </section>
<div class="invitation-container" style="margin-top: 30px;">
    <h3>Invitation Link</h3>
    <div class="link-box">
        <input type="text" id="dashboard-referral-link-input" readonly>
        <button id="dashboard-copy-referral-btn" onclick="copyLink('dashboard-referral-link-input')">Copy</button>
    </div>
</div>
                 </main>
            </div>
            <!-- All other app pages -->
            <div id="active-deposits-page">
                <header class="header">
                    <button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button>
                    <button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button>
                </header>
                <main class="page">
                    <h2 class="page-title">Deposit History</h2>
                    <div class="deposits-table-container">
                        <div class="deposits-table-header">
                            <span>Plan</span>
                            <span>Amount</span>
                            <span>Date</span>
                            <span>Status</span>
                        </div>
                        <div class="deposits-table-body" id="deposits-history-list">
                            <div class="no-deposits-message">
                                <p>No deposit history found.</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
            <div id="payment-page">
                <header class="header"><button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
                <main class="page">
                   <h2 class="page-title">Payment Methods</h2>
                   <div class="payment-methods-list">
                       <button class="payment-btn" onclick="showWithdrawFundPage('Easypaisa')">EASYPAISA</button>
                       <button class="payment-btn" onclick="showWithdrawFundPage('Jazzcash')">JAZZCASH</button>
                       <button class="payment-btn" onclick="showWithdrawFundPage('Nayapay')">NAYAPAY</button>
                       <button class="payment-btn" onclick="showWithdrawFundPage('Sadapay')">SADAPAY</button>
                       <button class="payment-btn" onclick="showWithdrawFundPage('Upaisa')">UPaisa</button>
                   </div>
               </main>
           </div>
           <div id="withdraw-fund-page">
               <header class="header"><button class="back-btn" onclick="showPaymentPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
               <main class="page">
                   <h2 class="page-title">Withdraw Funds</h2>
                   <div class="withdraw-form-container">
                       <img id="withdraw-logo" src="" alt="Payment Method Logo" class="payment-logo">
                       <form onsubmit="handleWithdraw(event)">
                           <input type="text" id="withdraw-account-name" placeholder="Your account name" required>
                           <input type="text" id="withdraw-account-no" placeholder="Your account no" required>
                           <input type="number" id="withdraw-amount" placeholder="Enter Amount" required>
                           <button type="submit" class="withdraw-now-btn">Withdraw Now</button>
                       </form>
                       <div class="withdraw-note-card">
                           <h3>Note:</h3>
                           <p>1. Minimum withdrawal is Rs. 10.</p>
                           <p>2. If you do not receive your withdrawal within 24 hours, please contact customer support.</p>
                           <p>3. Withdrawal requests are processed between 9 AM and 10 PM.</p>
                       </div>
                   </div>
               </main>
           </div>
           <div id="packages-page">
                <header class="header"><button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
                <main class="page">
                   <h2 class="page-title">Packages Plans</h2>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-01</h3><span class="plan-price">PKR 200</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-01', '200')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">15</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">975</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-02</h3><span class="plan-price">PKR 500</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-02', '500')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">38</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">2470</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-03</h3><span class="plan-price">PKR 1200</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-03', '1200')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                          <div class="detail-item"><p class="detail-value">90</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">5850</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-04</h3><span class="plan-price">PKR 2430</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-04', '2430')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">185</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">12025</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-05</h3><span class="plan-price">PKR 5060</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-05', '5060')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">363</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">23595</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-06</h3><span class="plan-price">PKR 10620</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-06', '10620')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">850</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">55250</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-07</h3><span class="plan-price">PKR 21240</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-07', '21240')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">1700</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">110500</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-08</h3><span class="plan-price">PKR 42480</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-08', '42480')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">3400</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">221000</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-09</h3><span class="plan-price">PKR 53100</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-09', '53100')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">4250</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">276250</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                   <div class="plan-card">
                       <div class="plan-header">
                           <div><h3 class="plan-title">Plan-10</h3><span class="plan-price">PKR 74340</span></div>
                           <button class="buy-plan-btn" onclick="showDepositPaymentPage('Plan-10', '74340')">Buy</button>
                       </div>
                       <div class="plan-details-grid">
                           <div class="detail-item"><p class="detail-value">5950</p><p class="detail-label">Daily Profit</p></div>
                           <div class="detail-item"><p class="detail-value">386750</p><p class="detail-label">Total Profit</p></div>
                           <div class="detail-item"><p class="detail-value">65</p><p class="detail-label">Days</p></div>
                           <div class="detail-item"><p class="detail-value">1.7%</p><p class="detail-label">Commission</p></div>
                       </div>
                   </div>
                </main>
           </div>
           <div id="deposit-payment-page">
               <header class="header"><button class="back-btn" onclick="showPackagesPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
               <main class="page">
                   <h2 class="page-title">Payment Methods</h2>
                   <div class="payment-methods-list">
                       <button class="payment-btn" onclick="showDepositDetailsPage('Easypaisa')">EASYPAISA</button>
                       <button class="payment-btn" onclick="showDepositDetailsPage('Jazzcash')">JAZZCASH</button>
                   </div>
               </main>
           </div>
           <div id="deposit-details-page">
               <header class="header"><button class="back-btn" onclick="showDepositPaymentPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
               <main class="page deposit-details-page-content">
                   <img id="deposit-method-logo" src="" alt="Payment Method Logo" class="deposit-method-logo">
                   <div class="info-box">
                       Deposit the package amount to our address within 10 minutes to complete the order.
                   </div>
                   <div class="details-box">
                       <div class="detail-row"><span>Deposit Amount</span><span id="deposit-amount-details"></span></div>
                       <div class="detail-row"><span>Bank Name</span><span id="deposit-bank-name"></span></div>
                       <div class="detail-row"><span>Account Name</span><span id="deposit-account-name"></span></div>
                       <div class="detail-row"><span>Account No</span><span id="deposit-account-no"></span></div>
                   </div>
                   <div class="proof-box">
                       <h3>Upload Your Deposit Proof</h3>
                       <form onsubmit="handleDepositProof(event)">
                           <input type="text" id="transaction-id-input" placeholder="Transaction ID" required>
                           <input type="text" id="sender-name-input" placeholder="Sender Account Name" required>
                           <input type="text" id="sender-account-no-input" placeholder="Sender Account Number" required>
                           <button type="submit" class="upload-proof-btn">Upload Proof</button>
                       </form>
                   </div>
               </main>
           </div>
            <div id="referrals-page">
                <header class="header">
                    <button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button>
                    <button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button>
                </header>
                <main class="page">
                    <div class="invitation-container">
                        <h3>Invitation Link</h3>
                        <div class="link-box">
                            <input type="text" id="referral-link-input" readonly>
                            <button id="copy-referral-btn" onclick="copyLink('referral-link-input')">Copy</button>
                        </div>
                    </div>
                    <div style="background-color: #1e1e1e; color: #b0b0b0; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333333;">
    <p style="margin: 0; font-size: 0.9em;">
        <strong>Note:</strong> You will receive a 1.7% daily referral commission. When your referral purchases a plan, you will earn a 1.7% bonus from their daily ad earnings.
    </p>
</div>
                    <div class="referrals-list-title">Level-1 Referrals</div>
                    <div class="referrals-list-container">
                        <div class="referrals-list-header">
                            <span>#</span>
                            <span>Username</span>
                            <span>Since</span>
                            <span>Deposit</span>
                            <span>Bonus</span>
                        </div>
                        <div id="referrals-list">
                           <div class="no-referrals">
                                <p>No referrals found.</p>
                           </div>
                        </div>
                    </div>
                </main>
            </div>
            <div id="profile-page">
                <header class="header"><button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
                <main class="page">
                    <h2 class="page-title">Profile</h2>
                    <div class="profile-form-container">
                        <div class="profile-form-row">
                            <label>User Name</label>
                            <input type="text" id="profile-username" disabled>
                        </div>
                        <div class="profile-form-row">
                            <label>Phone No</label>
                            <input type="tel" id="profile-phone" disabled>
                        </div>
                         <div class="profile-form-row">
                            <label>Email</label>
                            <input type="email" id="profile-email" disabled>
                        </div>
                        <div class="profile-form-row">
                            <label>Password</label>
                            <input type="text" id="profile-password" disabled>
                        </div>
                    </div>
                </main>
            </div>
            <div id="task-page">
                <header class="header">
                    <button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button>
                    <h1 class="header-title"><span>Daily</span> Task</h1>
                    <button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button>
                </header>
                <main class="page" id="tasks-container">
                    <div class="no-history">
                        <p>Loading your tasks...</p>
                    </div>
                </main>
            </div>
            <div id="earning-history-page">
                <header class="header"><button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
                <main class="page">
                    <h2 class="page-title">Earning History</h2>
                    <div class="history-container">
                        <div class="history-header">
                            <span>#</span>
                            <span>Earning Date</span>
                            <span>Active Package</span>
                            <span>Profit Amount</span>
                        </div>
                        <div id="history-list">
                            <div class="no-history">
                                <p>No Earning History Found.</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
            <div id="withdraw-history-page">
                <header class="header"><button class="back-btn" onclick="showDashboardPage()"><i class="fa-solid fa-arrow-left"></i></button><button class="power-btn" onclick="handleLogout()"><i class="fa-solid fa-right-from-bracket"></i></button></header>
                <main class="page">
                    <h2 class="page-title">Withdraw History</h2>
                    <div class="history-container">
                        <div class="history-header">
                            <span>#</span>
                            <span>Date</span>
                            <span>Method</span>
                            <span>Amount</span>
                            <span>Status</span>
                        </div>
                        <div id="withdraw-history-list">
                            <div class="no-history">
                                <p>No Withdraw History Found.</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
            <nav class="bottom-nav">
                <a href="javascript:void(0);" class="nav-item" onclick="showDashboardPage()"><i class="fa-solid fa-house"></i><span>Home</span></a>
                <a href="javascript:void(0);" class="nav-item" onclick="showPaymentPage()"><i class="fa-solid fa-file-invoice-dollar"></i><span>Withdraw</span></a>
                <a href="javascript:void(0);" class="nav-item" onclick="showActiveDepositsPage()"><i class="fa-solid fa-piggy-bank"></i><span>Deposits</span></a>
                <a href="javascript:void(0);" class="nav-item" onclick="showProfilePage()"><i class="fa-solid fa-user"></i><span>Account</span></a>
            </nav>
        </div>
    </div>
<div id="custom-alert-overlay" style="display: none;">
        <div id="custom-alert-box">
            <p id="custom-alert-message"></p>
            <button id="custom-alert-ok-btn" onclick="hideCustomAlert()">OK</button>
        </div>
    </div>
    <div id="custom-confirm-overlay" style="display: none;">
        <div id="custom-confirm-box">
            <p id="custom-confirm-message"></p>
            <div id="custom-confirm-buttons">
                <button id="custom-confirm-no-btn">Cancel</button>
                <button id="custom-confirm-yes-btn">Logout</button>
            </div>
        </div>
    </div>
    <script>
            // ============================================
        // ===== CUSTOM ALERT KE LIYE NAYI FUNCTIONS =====
        // ============================================
        function showCustomAlert(message) {
            document.getElementById('custom-alert-message').textContent = message;
            document.getElementById('custom-alert-overlay').style.display = 'flex';
        }
        function hideCustomAlert() {
            document.getElementById('custom-alert-overlay').style.display = 'none';
        }
            function showCustomConfirm(message, onYes) {
            // Box ko dikhayein aur message set karein
            const confirmOverlay = document.getElementById('custom-confirm-overlay');
            document.getElementById('custom-confirm-message').textContent = message;
            confirmOverlay.style.display = 'flex';
            // Buttons ke click events set karein
            document.getElementById('custom-confirm-yes-btn').onclick = function() {
                confirmOverlay.style.display = 'none'; // Box chupayein
                onYes(); // Haan (Yes) wala kaam karein
            };
            document.getElementById('custom-confirm-no-btn').onclick = function() {
                confirmOverlay.style.display = 'none'; // Box chupayein
            };
        }
                const firebaseConfig = {
            apiKey: "AIzaSyB1kW_RUIm9IwCQHQ2Pse4y6O5Y-0ZgELw",
            authDomain: "service-app-93c44.firebaseapp.com",
            projectId: "service-app-93c44",
            storageBucket: "service-app-93c44.firebasestorage.app",
            messagingSenderId: "637840189336",
            appId: "1:637840189336:web:6e4f7050f2150523c3eded"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        // Page Elements
        const authPages = document.getElementById('auth-pages');
        const mainApp = document.getElementById('main-app');
        const allPages = document.querySelectorAll('#main-app > div');
        // State variables
        let currentPlan = {};
        let currentWithdrawMethod = '';
        let currentUserData = {};
        let depositListener = null;
        let withdrawalListener = null;
        // === NAYA VARIABLE URL SE REFERRER NIKALNE KE LIYE ===
        const urlParams = new URLSearchParams(window.location.search);
        const referrerUsername = urlParams.get('ref');
        // Configs
        const logos = {
            'Easypaisa': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSqD8qdYOndcDdIGSKebW8F4KD8RqRQoK1CBPsuAMzN6g&s',
            'Jazzcash': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSaTMT_-rMwUPSHjEWe34RZA_CdxfinWc5vW-_6FYNb7g&s',
            'Nayapay': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSYnbZ2xoAtwdtemT7V3PgvEVoPnj6I_0cqcobny0I_Ag&s',
            'Sadapay': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvlTB33hDfOVu7ShnOrseDZUl_XZgreBVv6LQ0THW2BA&s',
            'Upaisa': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSVZVYDar9rDYSfx5-IIeLQc0N07fT5fhiSdNHJzTJdfA&s'
        };
        const depositAccounts = {
            'Easypaisa': { name: 'Taufeeq Ahmed', number: '03262550724', bank: 'Easy Paisa' },
            'Jazzcash': { name: 'Taufeeq Ahmed', number: '03262550724', bank: 'Jazzcash' }
        };
                        const planDetailsConfig = {
            'Plan-01': { dailyProfit: 15, duration: 65 },
            'Plan-02': { dailyProfit: 38, duration: 65 },
            'Plan-03': { dailyProfit: 90, duration: 65 },
            'Plan-04': { dailyProfit: 185, duration: 65 },
            'Plan-05': { dailyProfit: 363, duration: 65 },
            'Plan-06': { dailyProfit: 850, duration: 65 }, // <-- YEH NAYI LINE HAI
            'Plan-07': { dailyProfit: 1700, duration: 65 },
            'Plan-08': { dailyProfit: 3400, duration: 65 },
            'Plan-09': { dailyProfit: 4250, duration: 65 },
            'Plan-10': { dailyProfit: 5950, duration: 65 },
        };
        // --- AUTHENTICATION ---
       auth.onAuthStateChanged(user => {
    if (user) {
        authPages.style.display = 'none';
        mainApp.style.display = 'block';
        loadAndListen(user);
    } else {
        authPages.style.display = 'block';
        mainApp.style.display = 'none';
        // ===== YAHAN NAYA FUNCTION CALL KAREIN =====
        resetAuthForms();
        if (depositListener) {
            depositListener.off();
        }
        if (withdrawalListener) {
            withdrawalListener.off();
            withdrawalListener = null;
        }
        if (earningHistoryListener) {
            earningHistoryListener.off();
            earningHistoryListener = null;
        }
    }
});
        // === IS FUNCTION MEIN DASHBOARD COMMISSION UPDATE KARNE KA CODE ADD KIYA GAYA HAI ===
        function loadAndListen(user) {
            database.ref('users/' + user.uid).on('value', snapshot => {
                if (snapshot.exists()) {
                    currentUserData = snapshot.val();
                    document.getElementById('dashboard-username').textContent = currentUserData.username;
                    // ===== TABDEELI YAHAN HAI: Lambay numbers ko theek karne ke liye .toFixed(2) ka istemal =====
                    document.getElementById('dashboard-balance').textContent = `PKR ${(currentUserData.balance || 0).toFixed(2)}`;
                    document.getElementById('dashboard-total-profit').textContent = `PKR ${(currentUserData.totalProfit || 0).toFixed(2)}`;
                    document.getElementById('dashboard-total-commission').textContent = `PKR ${(currentUserData.totalCommission || 0).toFixed(2)}`;
                    // ===== TABDEELI KHATAM =====
                    const referralLink = `${window.location.origin}${window.location.pathname}?ref=${currentUserData.username}`;
                    document.getElementById('dashboard-referral-link-input').value = referralLink;
                    document.getElementById('referral-link-input').value = referralLink;
                }
            });
            listenForUserDeposits(user.uid);
            listenForUserTasks(user.uid);
            listenForUserWithdrawals(user.uid);
            listenForUserEarnings(user.uid);
        }
        // === IS FUNCTION KO REFERRAL SYSTEM KE LIYE MUKAMMAL TOR PAR MODIFY KIYA GAYA HAI ===
        function handleAuth(event, type) {
            event.preventDefault();
            const btn = event.target.querySelector('.auth-btn');
            btn.disabled = true;
            btn.textContent = 'Processing...';
            if (type === 'signup') {
                const username = document.getElementById('signup-username').value.trim();
                const phone = document.getElementById('signup-phone').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                database.ref('users').orderByChild('username').equalTo(username).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            showCustomAlert("Username already exists. Please try another one.");
                            btn.disabled = false;
                            btn.textContent = 'Signup';
                            return;
                        }
                        const processSignup = (referrerUid = null) => {
                            auth.createUserWithEmailAndPassword(email, password)
                                .then(userCredential => {
                                    const user = userCredential.user;
                                    const newUserdata = {
                                        username: username,
                                        phone: phone,
                                        email: email,
                                        balance: 0,
                                        totalProfit: 0,
                                        totalCommission: 0,
                                        createdAt: firebase.database.ServerValue.TIMESTAMP
                                    };
                                    if (referrerUid) {
                                        newUserdata.referredBy = referrerUid;
                                    }
                                    const updates = {};
                                    updates['/users/' + user.uid] = newUserdata;
                                    if (referrerUid) {
                                        // YEH HAI NAYA BADLAV: Hum 'true' ki jagah zaroori data save kar rahe hain
                                        updates['/users/' + referrerUid + '/referrals/' + user.uid] = {
                                            username: username,
                                            joinDate: firebase.database.ServerValue.TIMESTAMP,
                                            totalDeposit: 0, // Shuru mein deposit 0 hoga
                                            totalBonus: 0 // Shuru mein bonus 0 hoga
                                        };
                                    }
                                    return database.ref().update(updates);
                                })
                                .catch(error => {
                                    showCustomAlert("Signup Error: " + error.message);
                                })
                                .finally(() => {
                                    btn.disabled = false;
                                    btn.textContent = 'Signup';
                                });
                        };
                        if (referrerUsername) {
                            database.ref('users').orderByChild('username').equalTo(referrerUsername).once('value')
                                .then(referrerSnapshot => {
                                    let referrerUid = null;
                                    if (referrerSnapshot.exists()) {
                                        const referrerData = referrerSnapshot.val();
                                        referrerUid = Object.keys(referrerData)[0];
                                    }
                                    processSignup(referrerUid);
                                })
                                .catch(error => {
                                    showCustomAlert("Could not verify referrer: " + error.message);
                                    processSignup(null);
                                });
                        } else {
                            processSignup();
                        }
                    })
                    .catch(error => {
                        showCustomAlert("Database Error: " + error.message);
                        btn.disabled = false;
                        btn.textContent = 'Signup';
                    });
            } else if (type === 'login') {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                auth.signInWithEmailAndPassword(email, password)
                    .catch(error => {
                        showCustomAlert("Login Error: " + error.message);
                    })
                    .finally(() => {
                        btn.disabled = false;
                        btn.textContent = 'Login';
                    });
            }
        }
        function handleLogout() {
    showCustomConfirm('Are you sure you want to logout?', function() {
        // Yeh code tab chalega jab user "Logout" button par click karega
        auth.signOut().catch(error => showCustomAlert(error.message));
    });
}
  function resetAuthForms() {
    // Signup form ke fields ko khali karein
    document.getElementById('signup-username').value = '';
    document.getElementById('signup-phone').value = '';
    document.getElementById('signup-email').value = '';
    document.getElementById('signup-password').value = '';
    // Login form ke fields ko khali karein
    document.getElementById('login-email').value = '';
    document.getElementById('login-password').value = '';
    // Dono forms ke buttons ko reset karein
    const signupBtn = document.querySelector('#signup-page .auth-btn');
    if (signupBtn) {
        signupBtn.disabled = false;
        signupBtn.textContent = 'Signup';
    }
    const loginBtn = document.querySelector('#login-page .auth-btn');
    if (loginBtn) {
        loginBtn.disabled = false;
        loginBtn.textContent = 'Login';
    }
}
        // --- PAGE NAVIGATION ---
        function hideAllPages() {
            allPages.forEach(page => page.style.display = 'none');
        }
        function showPage(pageId) {
            hideAllPages();
            document.getElementById(pageId).style.display = 'block';
        }
        function showDashboardPage() { showPage('dashboard-page'); }
        function showPaymentPage() { showPage('payment-page'); }
        function showPackagesPage() { showPage('packages-page'); }
        function showActiveDepositsPage() { showPage('active-deposits-page'); }
        function showTaskPage() { showPage('task-page'); }
        // === YEH REFERRALS PAGE KO DIKHANE AUR DATA LOAD KARNE KE LIYE HAI ===
        function showReferralsPage() {
            showPage('referrals-page');
            const user = auth.currentUser;
            if(user){
                listenForReferrals(user.uid);
            }
        }
        function showEarningHistoryPage() { showPage('earning-history-page'); }
        function showWithdrawHistoryPage() { showPage('withdraw-history-page'); }
                function showProfilePage() {
            showPage('profile-page');
            document.getElementById('profile-username').value = currentUserData.username || '';
            document.getElementById('profile-phone').value = currentUserData.phone || '';
            document.getElementById('profile-email').value = currentUserData.email || '';
            // Ab hum yahan par hamesha fixed dots dikhayenge
            document.getElementById('profile-password').value = '**********';
        }
        // --- DEPOSIT FUNCTIONALITY ---
        function handleDepositProof(event) {
            event.preventDefault();
            const transactionId = document.getElementById('transaction-id-input').value;
            const senderName = document.getElementById('sender-name-input').value;
            const senderAccountNo = document.getElementById('sender-account-no-input').value;
            const submitBtn = event.target.querySelector('.upload-proof-btn');
            const user = auth.currentUser;
            if (!user) { alert('You are not logged in.'); return; }
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            const newDepositRef = database.ref('deposits').push();
            const depositRequest = {
                depositId: newDepositRef.key,
                userId: user.uid,
                username: currentUserData.username,
                amount: parseFloat(currentPlan.price),
                planName: currentPlan.name,
                transactionId: transactionId,
                senderName: senderName,
                senderAccountNo: senderAccountNo,
                status: 'pending',
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                taskCreated: false,
                referralNotified: false // Nayi field add ki gayi hai
            };
            newDepositRef.set(depositRequest)
                .then(() => {
                    showCustomAlert('Your deposit request has been submitted for review.');
                    event.target.reset();
                    showDashboardPage();
                })
                .catch(error => showCustomAlert('Error: ' + error.message))
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Upload Proof';
                });
        }
        // ===== Function Change Start: listenForUserDeposits =====
        function listenForUserDeposits(userId) {
            depositListener = database.ref('deposits').orderByChild('userId').equalTo(userId);
            depositListener.on('value', snapshot => {
                let totalApprovedAmount = 0;
                let pendingAmount = 0;
                const historyList = document.getElementById('deposits-history-list');
                historyList.innerHTML = '';
                if (!snapshot.exists()) {
                    historyList.innerHTML = '<div class="no-deposits-message"><p>No deposit history found.</p></div>';
                } else {
                    let rows = '';
                    snapshot.forEach(childSnapshot => {
                        const deposit = childSnapshot.val();
                        if (deposit.status === 'approved') {
                            totalApprovedAmount += deposit.amount;
                            if (!deposit.taskCreated) {
                                createTaskForUser(deposit);
                            }
                            // *** NAYA CODE: Jab deposit approve ho to referrer ko update karein ***
                            if (!deposit.referralNotified) {
                                database.ref('users/' + userId).once('value').then(userSnapshot => {
                                    if (userSnapshot.exists() && userSnapshot.val().referredBy) {
                                        const referrerUid = userSnapshot.val().referredBy;
                                        const referralNodeRef = database.ref(`users/${referrerUid}/referrals/${userId}`);
                                        referralNodeRef.transaction(currentData => {
                                            if (currentData) {
                                                currentData.totalDeposit = (currentData.totalDeposit || 0) + deposit.amount;
                                            }
                                            return currentData;
                                        });
                                        database.ref(`deposits/${deposit.depositId}`).update({ referralNotified: true });
                                    }
                                });
                            }
                            // *** NAYA CODE KHATAM ***
                        } else if (deposit.status === 'pending') {
                            pendingAmount += deposit.amount;
                        }
                        const depositDate = new Date(deposit.createdAt).toLocaleDateString();
                        const statusClass = `status-${deposit.status}`;
                        const statusText = deposit.status.charAt(0).toUpperCase() + deposit.status.slice(1);
                        rows = `<div class="history-row">
                                        <span>${deposit.planName}</span>
                                        <span>${deposit.amount} PKR</span>
                                        <span>${depositDate}</span>
                                        <span class="${statusClass}">${statusText}</span>
                                     </div>` + rows;
                    });
                    historyList.innerHTML = rows;
                }
                document.getElementById('dashboard-total-deposits').textContent = `PKR ${totalApprovedAmount}`;
                document.getElementById('dashboard-pending-deposits').textContent = `PKR ${pendingAmount}`;
            });
        }
        // ===== Function Change End: listenForUserDeposits =====
        function createTaskForUser(deposit) {
            const plan = planDetailsConfig[deposit.planName];
            if (!plan) {
                console.error("Plan details not found for:", deposit.planName);
                return;
            }
            const task = {
                userId: deposit.userId,
                depositId: deposit.depositId,
                planName: deposit.planName,
                dailyProfit: plan.dailyProfit,
                depositAmount: deposit.amount, // <-- YEH NAYI LINE ADD KI GAYI HAI
                duration: plan.duration,
                startDate: firebase.database.ServerValue.TIMESTAMP,
                lastClaimedTimestamp: 0
            };
            database.ref('user_tasks/' + deposit.userId + '/' + deposit.depositId).set(task)
                .then(() => {
                    database.ref('deposits/' + deposit.depositId).update({ taskCreated: true });
                });
        }
        let players = {};
        let playerTimers = {};
        let isApiReady = false;
        let currentVideoId = null;
        function onYouTubeIframeAPIReady() {
            isApiReady = true;
        }
                function onPlayerReady(event) {
            const iframe = event.target.getIframe();
            const taskId = iframe.id.replace('player-area-', '');
            const user = auth.currentUser;
            if (user) {
                database.ref('user_tasks/' + user.uid + '/' + taskId).once('value', snapshot => {
                    if(snapshot.exists()) {
                        updateTaskActionButtonState(taskId, snapshot.val());
                    }
                });
            }
        }
        function listenForUserTasks(userId) {
            const tasksRef = database.ref('user_tasks/' + userId);
            const videoAdRef = database.ref('settings/video_ad/url');
            const tasksContainer = document.getElementById('tasks-container');
            tasksRef.on('value', tasksSnapshot => {
                videoAdRef.once('value').then(videoSnapshot => {
                    const videoUrl = videoSnapshot.val();
if (videoUrl && typeof videoUrl === 'string') {
    let videoId = null;
    if (videoUrl.includes('embed/')) {
        // Embed URL handle karega: https://www.youtube.com/embed/VIDEO_ID
        const parts = videoUrl.split('embed/');
        if (parts.length > 1) {
            videoId = parts[1].split('?')[0];
        }
    } else if (videoUrl.includes('watch?v=')) {
        // Normal Watch URL handle karega: https://www.youtube.com/watch?v=VIDEO_ID
        const parts = videoUrl.split('watch?v=');
        if (parts.length > 1) {
            videoId = parts[1].split('&')[0]; // '&' se aage ke parameters hata dega
        }
    }
    currentVideoId = videoId;
} else {
    currentVideoId = null;
}
                    const thumbnailUrl = currentVideoId ? `https://img.youtube.com/vi/${currentVideoId}/hqdefault.jpg` : '';
                    const newActiveTaskIds = new Set();
                    if (tasksSnapshot.exists()) {
                        tasksSnapshot.forEach(taskChild => {
                            // ===== EXPIRATION CHECK YAHAN ADD KIYA GAYA HAI =====
                            const task = taskChild.val();
                            const startDate = task.startDate;
                            const durationInDays = task.duration;
                            const durationInMillis = durationInDays * 24 * 60 * 60 * 1000;
                            const expirationTimestamp = startDate + durationInMillis;
                            const isExpired = Date.now() > expirationTimestamp;
                            // Agar plan expire nahi hua hai, tab hi usko list mein shamil karein
                            if (!isExpired) {
                                newActiveTaskIds.add(taskChild.key);
                            } else {
                                // Optional: Expired task ko database se delete kar dein
                                // database.ref('user_tasks/' + userId + '/' + taskChild.key).remove();
                            }
                            // ===== EXPIRATION CHECK KHATAM =====
                        });
                    }
                    for (const taskId in players) {
                        if (!newActiveTaskIds.has(taskId)) {
                            if (players[taskId] && typeof players[taskId].destroy === 'function') {
                                players[taskId].destroy();
                            }
                            delete players[taskId];
                            if (playerTimers[`timer-${taskId}`]) clearInterval(playerTimers[`timer-${taskId}`]);
                            delete playerTimers[`timer-${taskId}`];
                            document.getElementById(`task-card-${taskId}`)?.remove();
                        }
                    }
                    // Pehle tasks container ko saaf karein
                    tasksContainer.innerHTML = '';
                    let hasVisibleTasks = false;
                    if (!tasksSnapshot.exists() || newActiveTaskIds.size === 0) {
                        tasksContainer.innerHTML = '<div class="no-history"><p>You have no active plans.</p></div>';
                        return;
                    }
                    if (!currentVideoId) {
                        tasksContainer.innerHTML = '<div class="no-history"><p>No tasks available right now.</p></div>';
                        return;
                    }
                    tasksSnapshot.forEach(taskChild => {
                        if (!newActiveTaskIds.has(taskChild.key)) return;
                        const task = taskChild.val();
                        const taskId = taskChild.key;
                        hasVisibleTasks = true;
                        // Sirf tab hi naya card banayein jab woh page par na ho
                        if (!document.getElementById(`task-card-${taskId}`)) {
                            const playerAreaId = `player-area-${taskId}`;
                            const thumbnailId = `thumbnail-${taskId}`;
                            const actionAreaId = `action-area-${taskId}`;
                            let taskCard = document.createElement('div');
                            taskCard.className = 'plan-card';
                            taskCard.id = `task-card-${taskId}`;
                            tasksContainer.appendChild(taskCard);
                            taskCard.innerHTML = `
                                <h3 class="plan-title">${task.planName} (Profit: ${task.dailyProfit} PKR)</h3>
                                <div class="video-container" id="video-container-${taskId}" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin: 15px 0; border-radius: 10px; background: #000;">
                                    <img src="${thumbnailUrl}" id="${thumbnailId}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; display: block; cursor:pointer;" onclick="runVideo('${taskId}')">
                                    <div id="${playerAreaId}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
                                </div>
                                <div id="${actionAreaId}" style="margin-top: 15px;"></div>`;
                            if (isApiReady) {
                                players[taskId] = new YT.Player(playerAreaId, {
                                    videoId: currentVideoId,
                                    events: {
                                        'onReady': onPlayerReady, // Player ke ready hone par is function ko call karein
                                        'onStateChange': onPlayerStateChange
                                    },
                                    playerVars: { 'controls': 0, 'disablekb': 1, 'rel': 0, 'modestbranding': 1, 'showinfo': 0, 'iv_load_policy': 3, 'fs': 0 }
                                });
                            }
                        }
                        // Button ko har baar update karein
                        updateTaskActionButtonState(taskId, task);
                    });
                    if (!hasVisibleTasks) {
                        tasksContainer.innerHTML = '<div class="no-history"><p>You have no active plans.</p></div>';
                    }
                });
            });
        }
        function runVideo(taskId) {
            const player = players[taskId];
            const thumbnail = document.getElementById(`thumbnail-${taskId}`);
            if (player && typeof player.playVideo === 'function') {
                if (thumbnail) thumbnail.style.display = 'none';
                player.playVideo();
                player.watchedTime = 0;
            } else {
                showCustomAlert("Video player is still loading. Please wait a moment.");
            }
        }
        function onPlayerStateChange(event) {
            const iframe = event.target.getIframe();
            const taskId = iframe.id.replace('player-area-', '');
            const actionArea = document.getElementById(`action-area-${taskId}`);
            const requiredWatchTime = 15;
            if (playerTimers[taskId]) clearInterval(playerTimers[taskId]);
            if (event.data == YT.PlayerState.PLAYING) {
                let watchedTime = players[taskId].watchedTime || 0;
                playerTimers[taskId] = setInterval(() => {
                    watchedTime++;
                    players[taskId].watchedTime = watchedTime;
                    let remainingTime = requiredWatchTime - watchedTime;
                    actionArea.innerHTML = `<button class="buy-plan-btn" style="width:100%; background: grey;" disabled>Time remaining: ${remainingTime > 0 ? remainingTime : 0}s</button>`;
                    if (watchedTime >= requiredWatchTime) {
                        clearInterval(playerTimers[taskId]);
                        players[taskId].stopVideo();
                        actionArea.innerHTML = `<button class="buy-plan-btn" style="width:100%;" onclick="claimProfit('${taskId}')">Claim Profit</button>`;
                    }
                }, 1000);
            }
        }
        function claimProfit(taskId) {
            const user = auth.currentUser;
            if (!user) { alert('You are not logged in.'); return; }
            const taskRef = database.ref(`user_tasks/${user.uid}/${taskId}`);
            const userRef = database.ref(`users/${user.uid}`);
            const actionArea = document.getElementById(`action-area-${taskId}`);
            actionArea.innerHTML = `<button class="buy-plan-btn" disabled style="width:100%; background: grey;">Processing...</button>`;
            taskRef.transaction(task => {
                if (task) {
                    const lastClaimTimestamp = task.lastClaimedTimestamp || 0;
                    const cooldownPeriod = 24 * 60 * 60 * 1000;
                    const timeSinceLastClaim = Date.now() - lastClaimTimestamp;
                    if (timeSinceLastClaim >= cooldownPeriod) {
                        task.lastClaimedTimestamp = firebase.database.ServerValue.TIMESTAMP;
                        return task;
                    }
                }
                return undefined;
            }).then(taskResult => {
                if (taskResult.committed && taskResult.snapshot.exists()) {
                    const taskData = taskResult.snapshot.val();
                    const dailyProfit = taskData.dailyProfit; // User ka apna profit yahan save hota hai
                    // ===== USER A KI APNI EARNING THEEK KARNE KA CODE START =====
                    userRef.transaction(currentUserData => {
                        if (currentUserData) {
                            // Yahan par humesha `dailyProfit` hi jama hoga
                            currentUserData.balance = (currentUserData.balance || 0) + dailyProfit;
                            currentUserData.totalProfit = (currentUserData.totalProfit || 0) + dailyProfit;
                        }
                        return currentUserData;
                    }).then(() => {
                        showCustomAlert(`Profit of ${dailyProfit} PKR claimed!`);
                        updateTaskActionButtonState(taskId, taskData);
                    // ===== USER A KI APNI EARNING THEEK KARNE KA CODE END =====
                        // === REFERRAL COMMISSION KA LOGIC (Yeh alag se kaam karega) ===
                        userRef.once('value', snapshot => {
                            const userData = snapshot.val();
                            if (userData && userData.referredBy) {
                                const referrerUid = userData.referredBy;
                                const commissionRate = 1.7;
                                // Commission ke liye hum `depositAmount` istemal kar rahe hain
                                const commissionAmount = (taskData.depositAmount * commissionRate) / 100;
                                if (commissionAmount > 0) {
                                    const referrerRef = database.ref('users/' + referrerUid);
                                    referrerRef.transaction(referrerData => {
                                        if (referrerData) {
                                            referrerData.balance = (referrerData.balance || 0) + commissionAmount;
                                            referrerData.totalCommission = (referrerData.totalCommission || 0) + commissionAmount;
                                        }
                                        return referrerData;
                                    });
                                    const referralNodeRef = database.ref(`users/${referrerUid}/referrals/${user.uid}`);
                                    referralNodeRef.transaction(currentData => {
                                        if (currentData) {
                                            currentData.totalBonus = (currentData.totalBonus || 0) + commissionAmount;
                                        }
                                        return currentData;
                                    });
                                }
                            }
                        });
                        // === COMMISSION LOGIC KHATAM ===
                    });
                } else {
                    showCustomAlert("Profit cannot be claimed yet. Please wait.");
                    taskRef.once('value', snapshot => updateTaskActionButtonState(taskId, snapshot.val()));
                }
            }).catch(error => {
                showCustomAlert("Error claiming profit: " + error.message);
                taskRef.once('value', snapshot => updateTaskActionButtonState(taskId, snapshot.val()));
            });
        }
        // ===== Function Change End: claimProfit =====
        // --- HELPER FUNCTIONS ---
        function showDepositPaymentPage(planName, planPrice) {
            if (planName && planPrice) {
                currentPlan = { name: planName, price: planPrice };
            }
            showPage('deposit-payment-page');
        }
        function showDepositDetailsPage(method) {
            showPage('deposit-details-page');
            const account = depositAccounts[method];
            document.getElementById('deposit-method-logo').src = logos[method];
            document.getElementById('deposit-amount-details').textContent = `${currentPlan.price} PKR`;
            document.getElementById('deposit-bank-name').textContent = account.bank;
            document.getElementById('deposit-account-name').textContent = account.name;
            document.getElementById('deposit-account-no').textContent = account.number;
        }
        function showWithdrawFundPage(method) {
            currentWithdrawMethod = method;
            showPage('withdraw-fund-page');
            document.getElementById('withdraw-logo').src = logos[method];
            document.getElementById('withdraw-logo').alt = `${method} Logo`;
        }
                function copyLink(inputId) {
            // Step 1: Input field ko uski ID se hasil karein
            const linkInput = document.getElementById(inputId);
            // Step 2: Input ke text ko select karein
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // Yeh line mobile browsers ke liye zaroori hai
            try {
                // Step 3: Copy command chalaein
                document.execCommand('copy');
                // Kamyabi ka message dikhayein
                showCustomAlert('Referral link copy ho gaya!');
            } catch (err) {
                // Agar copy na ho sake to error dikhayein
                showCustomAlert('Link copy nahi ho saka. Baraye meharbani manual copy karein.');
            }
        }
        function openGroupChat() {
            const groupLink = "https://whatsapp.com/channel/0029VbAtpkx4inovaSRul70x";
            window.open(groupLink, '_blank');
        }
        function contactAdmin() {
    window.location.href = "mailto:x4uearncontact.com";
}
        function handleWithdraw(event) {
            event.preventDefault();
            const accountName = document.getElementById('withdraw-account-name').value;
            const accountNo = document.getElementById('withdraw-account-no').value;
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const submitBtn = event.target.querySelector('.withdraw-now-btn');
            const user = auth.currentUser;
            if (!user) { alert('You are not logged in.'); return; }
            if (isNaN(amount) || amount <= 0) {
                showCustomAlert('Please enter a valid amount.');
                return;
            }
            if (amount < 10) {
                showCustomAlert('Minimum withdrawal amount is PKR 10.');
                return;
            }
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            const userRef = database.ref('users/' + user.uid);
            userRef.transaction(currentData => {
                if (currentData) {
                    if ((currentData.balance || 0) >= amount) {
                        currentData.balance = currentData.balance - amount;
                        return currentData;
                    }
                }
                return undefined;
            })
            .then(transactionResult => {
                if (transactionResult.committed) {
                    const newWithdrawalRef = database.ref('withdrawals').push();
                    const withdrawalRequest = {
                        withdrawalId: newWithdrawalRef.key,
                        userId: user.uid,
                        username: currentUserData.username,
                        method: currentWithdrawMethod,
                        accountName: accountName,
                        accountNo: accountNo,
                        amount: amount,
                        status: 'pending',
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    };
                    return newWithdrawalRef.set(withdrawalRequest);
                } else {
                    throw new Error('Insufficient balance.');
                }
            })
            .then(() => {
                showCustomAlert('Withdrawal request submitted successfully!');
                event.target.reset();
                showDashboardPage();
            })
            .catch(error => {
                showCustomAlert('Error: ' + error.message);
                if (error.message !== 'Insufficient balance.') {
                    // Agar koi aur error aati hai to amount wapis karne ki koshish karein
                    userRef.transaction(currentData => {
                         if(currentData){
                            currentData.balance = (currentData.balance || 0) + amount;
                         }
                         return currentData;
                    });
                }
            })
            .finally(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Withdraw Now';
            });
        }
                function listenForUserWithdrawals(userId) {
            if (withdrawalListener) {
                withdrawalListener.off();
            }
            withdrawalListener = database.ref('withdrawals').orderByChild('userId').equalTo(userId);
            withdrawalListener.on('value', snapshot => {
                let totalApprovedWithdrawals = 0;
                let totalPendingWithdrawals = 0;
                const withdrawHistoryList = document.getElementById('withdraw-history-list');
                withdrawHistoryList.innerHTML = ''; // List ko saaf karein
                if (!snapshot.exists()) {
                    withdrawHistoryList.innerHTML = '<div class="no-history"><p>No Withdraw History Found.</p></div>';
                } else {
                    let rows = '';
                    let count = 0; // Records ginne ke liye counter
                    snapshot.forEach(childSnapshot => {
                        count++; // Counter ko barhayein
                        const withdrawal = childSnapshot.val();
                        if (withdrawal.status === 'approved') {
                            totalApprovedWithdrawals += withdrawal.amount;
                        } else if (withdrawal.status === 'pending') {
                            totalPendingWithdrawals += withdrawal.amount;
                        }
                        const withdrawalDate = new Date(withdrawal.createdAt).toLocaleDateString();
                        const statusClass = `status-${withdrawal.status}`;
                        const statusText = withdrawal.status.charAt(0).toUpperCase() + withdrawal.status.slice(1);
                        // Row ko 5 columns ke saath banayein (bina inline style ke)
                        rows = `<div class="history-row">
                                        <span>${count}</span>
                                        <span>${withdrawalDate}</span>
                                        <span>${withdrawal.method}</span>
                                        <span>${withdrawal.amount} PKR</span>
                                        <span class="${statusClass}">${statusText}</span>
                                     </div>` + rows;
                    });
                    // Yahan se extra header banane wala code hata diya gaya hai
                    withdrawHistoryList.innerHTML = rows;
                }
                document.getElementById('dashboard-total-withdraws').textContent = `PKR ${totalApprovedWithdrawals}`;
                document.getElementById('dashboard-pending-withdraws').textContent = `PKR ${totalPendingWithdrawals}`;
            });
        }
        let earningHistoryListener = null;
                       function updateTaskActionButtonState(taskId, taskData) {
            const actionArea = document.getElementById(`action-area-${taskId}`);
            if (!actionArea) return;
            const lastClaimTimestamp = taskData.lastClaimedTimestamp || 0;
            const cooldownPeriod = 24 * 60 * 60 * 1000;
            const isClickable = (Date.now() - lastClaimTimestamp) >= cooldownPeriod;
            if (playerTimers[`timer-${taskId}`]) {
                clearInterval(playerTimers[`timer-${taskId}`]);
                delete playerTimers[`timer-${taskId}`];
            }
            if (isClickable) {
                const player = players[taskId];
                // YEH HAI NAYA BADLAV: Hum check kar rahe hain ki player video chalaane ke liye taiyaar hai ya nahi
                if (player && typeof player.playVideo === 'function') {
                    actionArea.innerHTML = `<button class="buy-plan-btn" style="width:100%" onclick="runVideo('${taskId}')">Run Video</button>`;
                } else {
                    // Agar player ready nahi hai, to "Loading" dikhayein taake user click na kar sake
                    actionArea.innerHTML = `<button class="buy-plan-btn" style="width:100%; background-color:#34495e; cursor:not-allowed;" disabled>Loading Video...</button>`;
                }
            } else {
                const updateTimer = () => {
                    const timeLeft = cooldownPeriod - (Date.now() - lastClaimTimestamp);
                    if (timeLeft > 0) {
                        const h = Math.floor(timeLeft / 3600000);
                        const m = Math.floor((timeLeft % 3600000) / 60000);
                        const s = Math.floor((timeLeft % 60000) / 1000);
                        actionArea.innerHTML = `<button class="buy-plan-btn" style="width:100%; background-color:#34495e; cursor:not-allowed;" disabled>Next ad in: ${h}h ${m}m ${s}s</button>`;
                    } else {
                        // Timer poora hone par bhi check karein ki player ready hai ya nahi
                        const player = players[taskId];
                        if (player && typeof player.playVideo === 'function') {
                            actionArea.innerHTML = `<button class="buy-plan-btn" style="width:100%" onclick="runVideo('${taskId}')">Run Video</button>`;
                        } else {
                            actionArea.innerHTML = `<button class="buy-plan-btn" style="width:100%; background-color:#34495e; cursor:not-allowed;" disabled>Loading Video...</button>`;
                        }
                        if (playerTimers[`timer-${taskId}`]) {
                            clearInterval(playerTimers[`timer-${taskId}`]);
                            delete playerTimers[`timer-${taskId}`];
                        }
                    }
                };
                updateTimer();
                playerTimers[`timer-${taskId}`] = setInterval(updateTimer, 1000);
            }
        }
        function listenForUserEarnings(userId) {
            if (earningHistoryListener) {
                earningHistoryListener.off();
            }
            earningHistoryListener = database.ref('earning_history').orderByChild('userId').equalTo(userId);
            earningHistoryListener.on('value', snapshot => {
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = '';
                if (!snapshot.exists()) {
                    historyList.innerHTML = '<div class="no-history"><p>No Earning History Found.</p></div>';
                } else {
                    let rows = '';
                    let count = 0;
                    snapshot.forEach(childSnapshot => {
                        const earning = childSnapshot.val();
                        count++;
                        const earningDate = new Date(earning.createdAt).toLocaleDateString();
                        rows = `<div class="history-row">
                                        <span>${count}</span>
                                        <span>${earningDate}</span>
                                        <span>${earning.planName || 'N/A'}</span>
                                        <span>${earning.amount} PKR</span>
                                     </div>` + rows;
                    });
                    historyList.innerHTML = rows;
                }
            });
        }
        // ===== Function Change Start: listenForReferrals =====
        function listenForReferrals(userId) {
            const referralsListContainer = document.getElementById('referrals-list');
            referralsListContainer.innerHTML = '<div class="no-referrals"><p>Loading referrals...</p></div>';
            const referralsRef = database.ref('users/' + userId + '/referrals');
            referralsRef.on('value', snapshot => {
                if (!snapshot.exists()) {
                    referralsListContainer.innerHTML = '<div class="no-referrals"><p>No referrals found.</p></div>';
                    return;
                }
                referralsListContainer.innerHTML = ''; // Pehle list ko clear karein
                let count = 0;
                snapshot.forEach(childSnapshot => {
                    count++;
                    const referralData = childSnapshot.val();
                    const referralRow = document.createElement('div');
                    // *** NAYI CLASS ADD KI GAYI HAI ***
                    referralRow.className = 'referral-row';
                    // *** HTML AB NAYE DATA KE SAATH UPDATE HOGA ***
                    referralRow.innerHTML = `
                        <span>${count}</span>
                        <span>${referralData.username}</span>
                        <span>${new Date(referralData.joinDate).toLocaleDateString()}</span>
                        <span>${(referralData.totalDeposit || 0).toFixed(2)}</span>
                        <span>${(referralData.totalBonus || 0).toFixed(2)}</span>
                    `;
                    referralsListContainer.appendChild(referralRow);
                });
            }, error => {
                 referralsListContainer.innerHTML = '<div class="no-referrals"><p>Could not load referrals.</p></div>';
                 console.error("Error loading referrals:", error);
            });
        }
        // ===== Function Change End: listenForReferrals =====
        function toggleAuthPages() {
            const signupPage = document.getElementById('signup-page');
            const loginPage = document.getElementById('login-page');
            if (signupPage.style.display === 'none') {
                signupPage.style.display = 'flex'; loginPage.style.display = 'none';
            } else {
                signupPage.style.display = 'none'; loginPage.style.display = 'flex';
            }
        }
    </script>
</body>
</html>
